<script>
	import axios from 'axios';
	import { fly } from 'svelte/transition';
	import {
		Button,
		ButtonGroup,
		Col,
		Row,
		Modal,
		ModalBody,
		ModalFooter,
		ModalHeader,
		Input,
		Label,
		Table
	} from 'sveltestrap';
	import {
		onMount
	} from "svelte";

	var books = [];
	var addBookForm = {
		title: '',
		author: '',
		description: '',
	};
	var editForm = {
		_id: '',
		title: '',
		author: '',
		description: '',
	};
	let mongoactive = true;
	let postgresactive = false;
	let redisactive = false;
	let esactive = false;
  let currentdb = 'mongo';
	function setMongo() {
		books = [];
	  mongoactive = true;
	  postgresactive = false;
		redisactive = false;
		esactive = false;
		currentdb = 'mongo';
		getBooks();
	};

	function setPostgres() {
		books = [];
	  mongoactive = false;
	  postgresactive = true;
		redisactive = false;
		esactive = false;
		currentdb = 'postgres';
		getBooks();
	};

	function setRedis() {
		books = [];
	  mongoactive = false;
	  postgresactive = false;
		redisactive = true;
		esactive = false;
		currentdb = 'redis';
		getBooks();
	};

	function setEs() {
		books = [];
	  mongoactive = false;
	  postgresactive = false;
		redisactive = false;
		esactive = true;
		currentdb = 'es';
		getBooks();
	};

	function getBooks() {
		axios.get(`/books/${currentdb}`)
			.then((res) => {
				books = res.data;
			});
	};

	function removeBook(bookID) {
		const path = `/books/${currentdb}/${bookID.book._id}`;
		axios.delete(path)
			.then(() => {
				getBooks();
			})
			.catch((error) => {
				console.error(error);
				getBooks();
			});
	};

	function initForm() {
		addBookForm.title = '';
		addBookForm.author = '';
		addBookForm.description = '';
		editForm._id = '';
		editForm.title = '';
		editForm.author = '';
		editForm.description = '';
	};

	function addBook() {
		const payload = {
			title: addBookForm.title,
			author: addBookForm.author,
			description: addBookForm.description,
		};
		const path = `/books/${currentdb}`;
		axios.post(path, payload)
			.then(() => {
				getBooks();
			})
			.catch((error) => {
				console.log(error);
				getBooks();
			});
		addtoggle();
	};

	function editBook(book) {
		updatetoggle();
		editForm = book.book;
	};

	function updateBook() {
		const payload = {
			title: editForm.title,
			author: editForm.author,
			description: editForm.description,
		};
		const path = `/books/${currentdb}/${editForm._id}`;
		axios.put(path, payload)
			.then(() => {
				getBooks();
			})
			.catch((error) => {
				console.error(error);
				getBooks();
			});
		updatetoggle();
	}
	onMount(getBooks);
	let addopen = false;

	function addtoggle() {
		initForm();
		addopen = !addopen;
	};
	let updateopen = false;

	function updatetoggle() {
		initForm();
		updateopen = !updateopen;
	};
</script>

<svelte:head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</svelte:head>

<style>
	:global(body) {
		background-image: url(data:image/png;base64,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);
	}
</style>

<div>
	<div class="row">
		<div class="col-sm-12">
			<h1>Books</h1>
			<hr><br>
			<Button color="success" on:click={addtoggle}>Add Book</Button>
			<span style="float: right;">
				<ButtonGroup>
					<Button color="success" active={mongoactive} outline={!mongoactive} on:click={setMongo}>MongoDB</Button>
					<Button color="primary" active={postgresactive} outline={!postgresactive} on:click={setPostgres}>PostgreSQL</Button>
					<Button color="primary" active={esactive} outline={!esactive} on:click={setEs}>ElasticSearch</Button>
					<Button color="danger" active={redisactive} outline={!redisactive} on:click={setRedis}>Redis</Button>
				</ButtonGroup>
			</span>
			<br><br>
			<Table hover>
				<thead>
					<tr>
						<th scope="col">Title</th>
						<th scope="col">Author</th>
						<th scope="col">Description</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					{#each books as book}
				<tr transition:fly="{{ y: 48, duration: 200 }}">
					<td>{ book.title }</td>
					<td>{ book.author }</td>
					<td>{ book.description }</td>
					<td><span style="float: right;">
						<Button color="warning" on:click={editBook({ book })}>Update</Button>
						<Button color="danger" on:click={removeBook({ book })}>Delete</Button>
						</span>
					</td>
				</tr>
				{/each}
        </tbody>
      </Table>
    </div>
  </div>
	<Modal isOpen={addopen} {addtoggle}>
		<ModalHeader {addtoggle}>Add a new book</ModalHeader>
		<ModalBody>
		  <Label for="newTitle">Title:</Label>
		  <Input type="text" bind:value={addBookForm.title} placeholder="book title"/>
			<p></p>
			<Label for="newAuthor">Author:</Label>
		  <Input type="text" bind:value={addBookForm.author} placeholder="book author"/>
			<p></p>
			<Label for="newTitle">Description:</Label>
		  <Input type="text" bind:value={addBookForm.description} placeholder="book description"/>
		</ModalBody>
		<ModalFooter>
			<Button color="primary" on:click={addBook}>
				Add book
			</Button>
			<Button color="secondary" on:click={addtoggle}>
				Cancel
			</Button>
		</ModalFooter>
	</Modal>
	<Modal isOpen={updateopen} {updatetoggle}>
		<ModalHeader {updatetoggle}>Update book</ModalHeader>
		<ModalBody>
			<Label for="newTitle">Title:</Label>
			<Input type="text" bind:value={editForm.title} placeholder="book title"/>
			<p></p>
			<Label for="newAuthor">Author:</Label>
			<Input type="text" bind:value={editForm.author} placeholder="book author"/>
			<p></p>
			<Label for="newTitle">Description:</Label>
			<Input type="text" bind:value={editForm.description} placeholder="book description"/>
		</ModalBody>
		<ModalFooter>
			<Button color="primary" on:click={updateBook}>
				Update
			</Button>
			<Button color="secondary" on:click={updatetoggle}>
				Cancel
			</Button>
		</ModalFooter>
	</Modal>
</div>
